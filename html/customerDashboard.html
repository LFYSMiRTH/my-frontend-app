<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer Dashboard - TMBYN CAFE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/customerDashboard.css">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="logo">
        <img src="/Logo/TambayanLogo.png" alt="TMBYN CAFE" class="logo-img" />
        <div class="logo-text">TMBYN CAFE</div>
      </div>
      <div class="nav-section">MAIN</div>
      <a href="#" class="nav-item active" data-view="dashboard">
        <i class="ri-home-line"></i> Dashboard
      </a>
      <a href="#" class="nav-item" data-view="menu">
        <i class="ri-store-2-line"></i> Menu
      </a>
      <a href="#" class="nav-item" data-view="myOrders">
        <i class="ri-shopping-bag-line"></i> My Orders
      </a>
      <a href="#" class="nav-item" data-view="profile">
        <i class="ri-user-settings-line"></i> Profile Settings
      </a>
      <a href="#" class="nav-item logout">
        <i class="ri-logout-box-r-line"></i> Logout
      </a>
    </aside>
    <main class="main-content">
      <div id="dashboardView" class="view active">
        <div class="header">
          <h1 class="welcome">Welcome back, Guest!</h1>
          <div class="bell-container">
            <i class="ri-bell-line bell"></i>
            <span class="notification-badge">0</span>
          </div>
        </div>
        <section class="section">
          <h2 class="section-title"><i class="ri-heart-3-line"></i> You Might Like...</h2>
          <div class="carousel-container">
            <div class="carousel-wrapper">
              <div class="carousel-nav prev"><i class="ri-arrow-left-s-line"></i></div>
              <div class="favorites-carousel" id="favoritesCarousel"></div>
              <div class="carousel-nav next"><i class="ri-arrow-right-s-line"></i></div>
            </div>
          </div>
        </section>
        <section class="section">
          <h2 class="section-title"><i class="ri-time-line"></i> Order Status Tracker</h2>
          <p><strong>Current Order: <span id="currentOrderText">No active order</span></strong></p>
          <div class="tracker">
            <div class="step">
              <div class="step-circle"><i class="ri-loader-2-fill"></i></div>
              <div class="step-label">Preparing</div>
            </div>
            <div class="step">
              <div class="step-circle"><i class="ri-check-line"></i></div>
              <div class="step-label">Ready</div>
            </div>
            <div class="step">
              <div class="step-circle"><i class="ri-truck-line"></i></div>
              <div class="step-label">Served</div>
            </div>
          </div>
          <p><small id="trackerTime">Last updated: just now</small></p>
        </section>
      </div>
      <div id="menuView" class="view">
        <div class="header">
          <h2>Menu</h2>
          <div class="cart-badge">
            <i class="ri-shopping-cart-line"></i>
            <span id="cartCount">0</span>
          </div>
        </div>
        <div class="controls">
          <input type="text" id="menuSearch" placeholder="Search menu items..." />
          <div class="category-filters">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="Drinks">Drinks</button>
            <button class="category-btn" data-category="Sandwiches">Sandwiches</button>
            <button class="category-btn" data-category="Desserts">Desserts</button>
          </div>
        </div>
        <div class="menu-grid" id="menuGrid"></div>
        <!-- Removed old checkout bar -->
      </div>
      <div id="myOrdersView" class="view">
        <div class="header">
          <h1>My Orders</h1>
        </div>
        <section class="section">
          <h2 class="section-title"><i class="ri-file-list-3-line"></i> Order History</h2>
          <table class="orders-table">
            <thead>
              <tr>
                <th>Order #</th>
                <th>Date & Time</th>
                <th>Status</th>
                <th>Total Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="myOrdersTableBody">
            </tbody>
          </table>
        </section>
      </div>
      <div id="profileView" class="view">
        <div class="header">
          <h1>Profile Settings</h1>
          <p>Manage your personal information and preferences</p>
        </div>
        <div class="profile-container">
          <div class="profile-picture-section">
            <div class="profile-picture">
                <div class="default-avatar-icon">
                  <i class="ri-user-line"></i>
                </div>
                <img id="profileImage" src="/image/default-avatar.jpg" alt="Profile Picture" />
                <div class="profile-picture-overlay">
                  <i class="ri-camera-line"></i>
                  <span>Change Photo</span>
                </div>
                <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">
              </div>
            <button class="change-photo-btn" onclick="document.getElementById('profilePictureInput').click()">
              Change Photo
            </button>
          </div>
          <div class="profile-form">
            <h3>Personal Information</h3>
            <form id="profileForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">First Name</label>
                  <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                  <label for="lastName">Last Name</label>
                  <input type="text" id="lastName" name="lastName" required>
                </div>
              </div>
              <div class="form-group">
                  <label for="email">Email Address</label>
                  <input type="email" id="email" name="email" required>
              </div>
              <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input type="tel" id="phone" name="phone" required>
              </div>
              <div class="form-group">
                  <label for="address">Address</label>
                  <textarea id="address" name="address" rows="3"></textarea>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="birthday">Birthday</label>
                  <input type="date" id="birthday" name="birthday">
                </div>
                <div class="form-group">
                  <label for="gender">Gender</label>
                  <select id="gender" name="gender">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>
              <div class="form-actions">
                <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
                <button type="submit" class="btn-primary">Save Changes</button>
              </div>
            </form>
          </div>
          <div class="security-section">
            <h3>Security</h3>
            <div class="security-options">
              <div class="security-option">
                <div class="option-info">
                  <h4>Change Password</h4>
                  <p>Update your account password</p>
                </div>
                <button class="btn-secondary open-change-password-btn">Change</button>
              </div>             
            </div>
          </div>
          <div class="account-actions">
            <h3>Account Actions</h3>
            <div class="action-buttons">
              <button class="btn-danger" onclick="deleteAccount()">Delete Account</button>
              <button class="btn-secondary">Export Data</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- === CART MODAL (POPUP) === -->
  <div class="modal" id="cartModal">
    <div class="modal-content">
      <span class="modal-close-btn" id="closeCartModal">&times;</span>
      <h2 class="section-title"><i class="ri-shopping-cart-line"></i> Your Cart</h2>
      <div class="cart-items-container">
        <!-- Items will be loaded here by JS -->
      </div>
      <div class="cart-summary">
        <div class="summary-row">
          <span>Total Items:</span>
          <span id="cartItemCount">0</span>
        </div>
        <div class="summary-row">
          <strong>Total Amount:</strong>
          <strong id="cartTotal">₱0.00</strong>
        </div>
      </div>
      <div class="cart-actions">
        <button id="checkoutBtn" class="checkout-btn" disabled>Place Order</button>
        <button id="clearCartBtn" class="btn-secondary">Clear Cart</button>
      </div>
    </div>
  </div>

  <div class="modal" id="changePasswordModal">
    <div class="modal-content">
      <span class="close" id="closePasswordModal"><i class="ri-close-line"></i></span>
      <h3>Change Password</h3>
      <form id="changePasswordForm">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input type="password" id="currentPassword" name="currentPassword" required>
        </div>
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input type="password" id="newPassword" name="newPassword" required>
        </div>
        <div class="form-group">
          <label for="confirmNewPassword">Confirm New Password</label>
          <input type="password" id="confirmNewPassword" name="confirmNewPassword" required>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" id="cancelPasswordBtn">Cancel</button>
          <button type="submit" class="btn-primary">Update Password</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal" id="itemModal">
  <div class="modal-content">
    <div class="modal-body">
      <!-- Modal Header: Image + Close Button -->
      <div class="modal-header">
        <img id="modalImage" alt="Item" />
        <button type="button" class="modal-close-btn" id="closeModal">&times;</button>
      </div>

      <!-- Item Info -->
      <h2 id="modalName"></h2>
      <p id="modalPrice"></p>
      <p><strong>Category:</strong> <span id="modalCategory"></span></p>
      <p><strong>Ingredients:</strong></p>
      <ul id="modalIngredients"></ul>
      <p id="modalAvailability"></p>

      <!-- Enhanced Customization Section -->
      <div class="customization-section">
        <div class="customization-group">
          <strong>Mood</strong>
          <div class="options">
            <button class="custom-option-btn" data-type="mood" data-value="Hot">
              <i class="ri-fire-line"></i> Hot
            </button>
            <button class="custom-option-btn" data-type="mood" data-value="Ice">
              <i class="ri-snowy-line"></i> Ice
            </button>
          </div>
        </div>
        <div class="customization-group">
          <strong>Size</strong>
          <div class="options">
            <button class="custom-option-btn" data-type="size" data-value="S">S</button>
            <button class="custom-option-btn" data-type="size" data-value="M">M</button>
            <button class="custom-option-btn" data-type="size" data-value="L">L</button>
          </div>
        </div>
        <div class="customization-group">
          <strong>Sugar</strong>
          <div class="options">
            <button class="custom-option-btn" data-type="sugar" data-value="30%">30%</button>
            <button class="custom-option-btn" data-type="sugar" data-value="50%">50%</button>
            <button class="custom-option-btn" data-type="sugar" data-value="70%">70%</button>
          </div>
        </div>
      </div>

      <!-- Quantity Control & Add to Cart -->
      <div class="modal-actions">
  <div class="quantity-control">
    <button type="button" class="qty-btn minus" id="modalQtyMinus">−</button>
    <input type="number" id="modalQuantity" min="1" value="1" />
    <button type="button" class="qty-btn plus" id="modalQtyPlus">+</button>
  </div>
  <button id="modalAddToCart" class="add-btn">ADD TO BILLING</button>
</div>
    </div>
  </div>
</div>

<div id="customAlert" class="modal">
  <div class="modal-content">
    <h3 id="alertTitle"></h3>
    <p id="alertMessage"></p>
    <button id="alertOkBtn">OK</button>
  </div>
</div>

<!-- === DELETE ACCOUNT CONFIRMATION MODAL (NEW) === -->
<div id="deleteConfirmModal" class="modal">
  <div class="modal-content">
    <h3>CONFIRM ACCOUNT DELETION</h3>
    <p>To confirm deletion, please enter your current password:</p>
    <input type="password" id="passwordInput" placeholder="Enter your password" autocomplete="current-password">
    <div class="modal-buttons">
      <button id="confirmDeleteBtn" class="btn-ok">OK</button>
      <button id="cancelDeleteBtn" class="btn-cancel">Cancel</button>
    </div>
  </div>
</div>

  <!-- === ORDER CONFIRMATION MODAL (BIRTHDAY & GENDER REMOVED) === -->
  <div id="orderConfirmationModal" class="modal">
    <div class="modal-content">
      <span class="modal-close-btn" id="closeOrderConfirmationModal">&times;</span>
      <h2 class="section-title"><i class="ri-check-double-line"></i> Confirm Your Order</h2>
      
      <div class="order-summary">
        <h3>Your Order Details</h3>
        <div class="cart-items-container" id="orderItemsContainer"></div>
        
        <div class="cart-summary">
          <div class="summary-row">
            <span>Total Items:</span>
            <span id="orderItemCount">0</span>
          </div>
          <div class="summary-row">
            <strong>Total Amount:</strong>
            <strong id="orderTotal">₱0.00</strong>
          </div>
        </div>
      </div>
      
      <div class="customer-info-form">
        <h3>Customer Information</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="customerFirstName">First Name *</label>
            <input type="text" id="customerFirstName" name="customerFirstName" required>
          </div>
          <div class="form-group">
            <label for="customerLastName">Last Name *</label>
            <input type="text" id="customerLastName" name="customerLastName" required>
          </div>
        </div>
        <div class="form-group">
          <label for="customerEmail">Email Address *</label>
          <input type="email" id="customerEmail" name="customerEmail" required>
        </div>
        <div class="form-group">
          <label for="customerPhone">Phone Number *</label>
          <input type="tel" id="customerPhone" name="customerPhone" required>
        </div>
        <div class="form-group">
          <label for="customerAddress">Delivery Address *</label>
          <textarea id="customerAddress" name="customerAddress" rows="3" required></textarea>
        </div>
      </div>
      
      <div class="order-actions">
        <button id="confirmOrderBtn" class="checkout-btn">CONFIRM ORDER</button>
        <button id="cancelOrderBtn" class="btn-secondary">CANCEL</button>
      </div>
    </div>
  </div>

  <script src="/js/customerDashboard.js"></script>
  <script>
    console.log("Customer Dashboard loaded!");
    console.log("Token:", localStorage.getItem('customerToken'));
    console.log("Customer Info:", localStorage.getItem('customerInfo'));
  </script>
  <script>
    console.log("Customer token on dashboard:", localStorage.getItem('customerToken'));
  </script>
</body>
</html>